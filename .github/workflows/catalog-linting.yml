name: Catalog Linting

on:
  pull_request:
    types: [opened, synchronize]
    branches: [main, develop]
    paths:
      - 'darwin-catalog/**'

jobs:
  lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: darwin-catalog

    steps:
      - name: Checkout repository
        id: checkout-service
        uses: actions/checkout@v4

      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: maven

      - name: Install Maven (if not present)
        run: |
          if ! command -v mvn &> /dev/null; then
            echo "Maven not found, installing..."
            cd /tmp
            curl -sL https://archive.apache.org/dist/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz | tar xz
            sudo mv apache-maven-3.9.6 /opt/maven
            echo "/opt/maven/bin" >> $GITHUB_PATH
            export PATH="/opt/maven/bin:$PATH"
          fi
          mvn --version
        working-directory: /

      - name: Run Spotless Check (Code Formatting)
        run: |
          echo "========================================"
          echo "Running Spotless Code Format Check..."
          echo "========================================"
          mvn spotless:check -B
          
      - name: Output Spotless Result
        if: success()
        run: |
          echo ""
          echo "✅ Code formatting check passed!"
          echo "All Java files follow Google Java Format standards."

      - name: Output Spotless Failure Details
        if: failure()
        run: |
          echo ""
          echo "❌ Code formatting check failed!"
          echo ""
          echo "Some files do not follow Google Java Format standards."
          echo "Run the following command locally to fix formatting:"
          echo ""
          echo "  cd darwin-catalog && mvn spotless:apply"
          echo ""
          echo "Then commit and push the changes."
