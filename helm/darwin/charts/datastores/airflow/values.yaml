image:
  repository: apache/airflow
  tag: "2.7.0"
  pullPolicy: IfNotPresent

executor: LocalExecutor

webserver:
  replicas: 1
  defaultUser:
    enabled: true
    username: darwin
    password: darwin
    firstName: Darwin
    lastName: User
    email: admin@darwin.local
    role: Admin
  service:
    type: ClusterIP
    port: 8080
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

scheduler:
  replicas: 1
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

workers:
  replicas: 2
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  persistence:
    enabled: true
    size: 10Gi

postgresql:
  enabled: false

redis:
  enabled: false

rabbitmq:
  enabled: true
  auth:
    username: airflow
    password: airflow
  persistence:
    enabled: true
    size: 5Gi

mysql:
  enabled: false  # Use existing MySQL service

config:
  core:
    dags_folder: /opt/airflow/dags
    load_examples: false
    logging_level: INFO
    executor: CeleryExecutor
  celery:
    worker_concurrency: 4
  webserver:
    expose_config: true
    rbac: true

dags:
  persistence:
    enabled: true
    size: 5Gi
    
logs:
  persistence:
    enabled: true
    size: 10Gi

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
  hosts:
    - host: airflow.darwin.local
      paths:
        - path: /
          pathType: Prefix

env:
  - name: AIRFLOW__CORE__FERNET_KEY
    value: "81HqDtbqAywKSOumSKKJ6HJJXBRw7LwVwF4XLrwLqsI="
  - name: AIRFLOW__DATABASE__SQL_ALCHEMY_CONN
    value: "mysql://root:password@darwin-mysql:3306/airflow"
  - name: AIRFLOW__CORE__EXECUTOR
    value: "CeleryExecutor"
  - name: AIRFLOW__CELERY__BROKER_URL
    value: "pyamqp://airflow:airflow@darwin-airflow-rabbitmq:5672//"
  - name: AIRFLOW__CELERY__RESULT_BACKEND
    value: "rpc://"
  - name: AIRFLOW__WEBSERVER__BASE_URL
    value: "http://localhost/airflow"

extraVolumes:
  - name: darwin-scripts
    configMap:
      name: darwin-airflow-scripts

extraVolumeMounts:
  - name: darwin-scripts
    mountPath: /opt/airflow/scripts
